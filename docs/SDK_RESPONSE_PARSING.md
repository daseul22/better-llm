# SDK ì‘ë‹µ íŒŒì‹± ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” Claude Agent SDKì˜ ì‘ë‹µì„ íŒŒì‹±í•˜ëŠ” ê³¼ì •ì„ ì‹œê°ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“Š ì „ì²´ íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Agent SDK                              â”‚
â”‚                   (ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ìƒì„±)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   SDK Response Types          â”‚
         â”‚                               â”‚
         â”‚  1. AssistantMessage          â”‚ â† Claudeì˜ í…ìŠ¤íŠ¸ ì‘ë‹µ
         â”‚  2. ResultMessage             â”‚ â† usage ì •ë³´ (í† í° ì‚¬ìš©ëŸ‰)
         â”‚  3. SystemMessage             â”‚ â† ì‹œìŠ¤í…œ ë©”íƒ€ë°ì´í„° (âœ… ì§€ì›)
         â”‚  4. UserMessage               â”‚ â† ì‚¬ìš©ì ì…ë ¥ (ë“œë¬¼ê²Œ)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   SDKResponseHandler          â”‚ â† ì¶”ìƒ í´ë˜ìŠ¤
         â”‚                               â”‚
         â”‚  â€¢ extract_text_from_response â”‚ â† í…ìŠ¤íŠ¸ ì¶”ì¶œ
         â”‚  â€¢ extract_usage_info         â”‚ â† í† í° ì‚¬ìš©ëŸ‰ ì¶”ì¶œ
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                 â”‚                   â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Manager Handler    â”‚   â”‚ Worker Handler     â”‚
     â”‚                    â”‚   â”‚                    â”‚
     â”‚ (ClaudeSDKClient)  â”‚   â”‚ (query í•¨ìˆ˜)       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚
             â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        ìµœì¢… í…ìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¼            â”‚
    â”‚  (ì‚¬ìš©ìì—ê²Œ í‘œì‹œ + í† í° ì¶”ì )       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…

### 1ë‹¨ê³„: SDK ì‘ë‹µ íƒ€ì… ì‹ë³„

Claude Agent SDKëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‘ë‹µ íƒ€ì…ì„ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤:

#### ğŸ“¨ AssistantMessage
- **ë‚´ìš©**: Claudeê°€ ìƒì„±í•œ ì‘ë‹µ
- **í¬í•¨ ìš”ì†Œ**:
  - `content`: TextBlock, ThinkingBlock, ToolUseBlock ë“±ì˜ ë¦¬ìŠ¤íŠ¸
  - `usage` (ì„ íƒ): í† í° ì‚¬ìš©ëŸ‰ ì •ë³´
- **ì˜ˆì‹œ**:
  ```python
  AssistantMessage(
      content=[
          TextBlock(text="ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"),
          ThinkingBlock(thinking="[ì‚¬ê³  ê³¼ì •: ì‚¬ìš©ìê°€ ì¸ì‚¬ë¥¼ ê±´ë„´]", signature="...")
      ],
      usage={
          'input_tokens': 120,
          'output_tokens': 45
      }
  )
  ```

  **ì°¸ê³ **: ThinkingBlock í•„ë“œ
  - `thinking` (str): ì‚¬ê³  ê³¼ì • í…ìŠ¤íŠ¸
  - `signature` (str): ì„œëª… ì •ë³´

#### ğŸ“Š ResultMessage
- **ë‚´ìš©**: ìŠ¤íŠ¸ë¦¬ë° ì¢…ë£Œ ì‹œ ì „ì†¡ë˜ëŠ” ë©”íƒ€ë°ì´í„°
- **í¬í•¨ ìš”ì†Œ**:
  - `usage`: ì „ì²´ í† í° ì‚¬ìš©ëŸ‰ í†µê³„
  - `stop_reason`: ì¢…ë£Œ ì´ìœ  (end_turn, max_tokens ë“±)
- **ì˜ˆì‹œ**:
  ```python
  ResultMessage(
      usage={
          'input_tokens': 1500,
          'output_tokens': 800,
          'cache_read_input_tokens': 500,  # ìºì‹œì—ì„œ ì½ì€ í† í°
          'cache_creation_input_tokens': 200  # ìºì‹œ ìƒì„± í† í°
      },
      stop_reason='end_turn'
  )
  ```

#### ğŸ”§ SystemMessage
- **ë‚´ìš©**: SDK ë‚´ë¶€ ìƒíƒœ ì •ë³´ ë˜ëŠ” ì‹œìŠ¤í…œ ë©”íƒ€ë°ì´í„°
- **í¬í•¨ ìš”ì†Œ**:
  - `content`: ë¬¸ìì—´ ë˜ëŠ” TextBlock ë¦¬ìŠ¤íŠ¸
  - `usage` (ì„ íƒ): í† í° ì‚¬ìš©ëŸ‰ ì •ë³´
- **ì˜ˆì‹œ**:
  ```python
  # ë¬¸ìì—´ content
  SystemMessage(
      content="Agent ì´ˆê¸°í™” ì™„ë£Œ"
  )

  # TextBlock ë¦¬ìŠ¤íŠ¸ content
  SystemMessage(
      content=[
          TextBlock(text="ì‹œìŠ¤í…œ ìƒíƒœ: ì •ìƒ")
      ]
  )
  ```

---

### 2ë‹¨ê³„: í…ìŠ¤íŠ¸ ì¶”ì¶œ (extract_text_from_response)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   extract_text_from_response                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [1] AssistantMessage?                                           â”‚
â”‚      â”œâ”€ YES â†’ content blocks ìˆœíšŒ                               â”‚
â”‚      â”‚        â”œâ”€ TextBlock ë°œê²¬? â†’ text ë°˜í™˜ âœ“                  â”‚
â”‚      â”‚        â”œâ”€ ThinkingBlock ë°œê²¬? â†’ text ë°˜í™˜ âœ“              â”‚
â”‚      â”‚        â””â”€ ToolUseBlock? â†’ ê±´ë„ˆë›°ê¸°                       â”‚
â”‚      â””â”€ NO â†’ ë‹¤ìŒ ë‹¨ê³„                                          â”‚
â”‚                                                                  â”‚
â”‚  [2] ResultMessage?                                              â”‚
â”‚      â”œâ”€ YES â†’ í…ìŠ¤íŠ¸ ì—†ìŒ, None ë°˜í™˜                            â”‚
â”‚      â””â”€ NO â†’ ë‹¤ìŒ ë‹¨ê³„                                          â”‚
â”‚                                                                  â”‚
â”‚  [3] SystemMessage?                                              â”‚
â”‚      â”œâ”€ YES â†’ content íƒ€ì… í™•ì¸                                 â”‚
â”‚      â”‚        â”œâ”€ ë¬¸ìì—´? â†’ ì§ì ‘ ë°˜í™˜ âœ“                          â”‚
â”‚      â”‚        â””â”€ ë¦¬ìŠ¤íŠ¸? â†’ TextBlock ì¶”ì¶œ âœ“                     â”‚
â”‚      â””â”€ NO â†’ ë‹¤ìŒ ë‹¨ê³„                                          â”‚
â”‚                                                                  â”‚
â”‚  [4] í´ë°± ì²˜ë¦¬ (í•˜ìœ„ í˜¸í™˜ì„±)                                     â”‚
â”‚      â”œâ”€ hasattr(response, 'content')?                           â”‚
â”‚      â”‚   â””â”€ content ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ â†’ text ì¶”ì¶œ ì‹œë„                â”‚
â”‚      â”œâ”€ hasattr(response, 'text')?                              â”‚
â”‚      â”‚   â””â”€ ì§ì ‘ text ë°˜í™˜                                      â”‚
â”‚      â””â”€ ëª¨ë‘ ì‹¤íŒ¨ â†’ None ë°˜í™˜                                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- âœ… **ë‹¨ê³„ì  í´ë°±**: ì•Œë ¤ì§„ íƒ€ì… â†’ SystemMessage â†’ ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì… ìˆœì„œë¡œ ì²˜ë¦¬
- âœ… **ì²« ë²ˆì§¸ í…ìŠ¤íŠ¸ë§Œ ë°˜í™˜**: ì—¬ëŸ¬ ë¸”ë¡ ì¤‘ ì²« í…ìŠ¤íŠ¸ë§Œ ì‚¬ìš©
- âœ… **ì•ˆì „í•œ ì†ì„± ì ‘ê·¼**: hasattr()ë¡œ ì†ì„± ì¡´ì¬ í™•ì¸
- âœ… **SystemMessage ìœ ì—°ì„±**: contentê°€ ë¬¸ìì—´ ë˜ëŠ” ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ì§€ì›

---

### 3ë‹¨ê³„: Usage ì •ë³´ ì¶”ì¶œ (extract_usage_info)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     extract_usage_info                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ì…ë ¥: usage_obj (dict ë˜ëŠ” object)                              â”‚
â”‚                                                                  â”‚
â”‚  [ë°©ë²• 1] dict íƒ€ì…?                                             â”‚
â”‚      â”œâ”€ YES â†’ .get() ë©”ì„œë“œë¡œ ì•ˆì „í•˜ê²Œ ì¶”ì¶œ                     â”‚
â”‚      â”‚        â€¢ input_tokens                                    â”‚
â”‚      â”‚        â€¢ output_tokens                                   â”‚
â”‚      â”‚        â€¢ cache_read_input_tokens                         â”‚
â”‚      â”‚        â€¢ cache_creation_input_tokens                     â”‚
â”‚      â””â”€ NO â†’ ë°©ë²• 2                                             â”‚
â”‚                                                                  â”‚
â”‚  [ë°©ë²• 2] object íƒ€ì…                                            â”‚
â”‚      â””â”€ hasattr()ë¡œ ê° ì†ì„± ì¡´ì¬ í™•ì¸ í›„ ì¶”ì¶œ                   â”‚
â”‚         â€¢ hasattr(usage, 'input_tokens')?                       â”‚
â”‚         â€¢ hasattr(usage, 'output_tokens')?                      â”‚
â”‚         â€¢ hasattr(usage, 'cache_read_tokens')?                  â”‚
â”‚         â€¢ hasattr(usage, 'cache_creation_tokens')?              â”‚
â”‚                                                                  â”‚
â”‚  ì¶œë ¥: usage_dict (ì •ê·œí™”ëœ ë”•ì…”ë„ˆë¦¬)                            â”‚
â”‚  {                                                               â”‚
â”‚      'input_tokens': 1500,                                       â”‚
â”‚      'output_tokens': 800,                                       â”‚
â”‚      'cache_read_tokens': 500,                                   â”‚
â”‚      'cache_creation_tokens': 200                                â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- âœ… **íƒ€ì… ìœ ì—°ì„±**: dictì™€ object ëª¨ë‘ ì§€ì›
- âœ… **ì•ˆì „í•œ ì¶”ì¶œ**: ì†ì„±ì´ ì—†ì–´ë„ ì˜¤ë¥˜ ì—†ì´ ì²˜ë¦¬
- âœ… **ì •ê·œí™”**: í•­ìƒ ë™ì¼í•œ í‚¤ ì´ë¦„ìœ¼ë¡œ ë°˜í™˜

---

### 4ë‹¨ê³„: Response Handler ì²˜ë¦¬ íë¦„

#### ManagerResponseHandler / WorkerResponseHandler

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    process_response()                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [1ë‹¨ê³„] ResultMessage?                                          â”‚
â”‚      â”œâ”€ usage ì •ë³´ ì¶”ì¶œ (extract_usage_info)                    â”‚
â”‚      â”œâ”€ ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ (usage_callback)                         â”‚
â”‚      â””â”€ return (í…ìŠ¤íŠ¸ ì—†ìŒ, ì¢…ë£Œ)                              â”‚
â”‚                                                                  â”‚
â”‚  [2ë‹¨ê³„] AssistantMessage?                                       â”‚
â”‚      â”œâ”€ (2-1) usage ì •ë³´ ì¶”ì¶œ ë° ì½œë°± í˜¸ì¶œ                      â”‚
â”‚      â”œâ”€ (2-2) í…ìŠ¤íŠ¸ ì¶”ì¶œ (extract_text_from_response)          â”‚
â”‚      â””â”€ yield text (ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ í…ìŠ¤íŠ¸ ë°˜í™˜)                   â”‚
â”‚                                                                  â”‚
â”‚  [3ë‹¨ê³„] SystemMessage?                                          â”‚
â”‚      â”œâ”€ (3-1) usage ì •ë³´ ì¶”ì¶œ ë° ì½œë°± í˜¸ì¶œ (ìˆìœ¼ë©´)             â”‚
â”‚      â”œâ”€ (3-2) í…ìŠ¤íŠ¸ ì¶”ì¶œ (extract_text_from_response)          â”‚
â”‚      â””â”€ yield text (ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ í…ìŠ¤íŠ¸ ë°˜í™˜)                   â”‚
â”‚                                                                  â”‚
â”‚  [4ë‹¨ê³„] ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì… (í´ë°±)                                  â”‚
â”‚      â”œâ”€ (4-1) usage ì •ë³´ ì¶”ì¶œ ì‹œë„                              â”‚
â”‚      â”œâ”€ (4-2) í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹œë„                                  â”‚
â”‚      â””â”€ yield text (ìˆìœ¼ë©´)                                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- âœ… **ìˆœì„œ ë³´ì¥**: ResultMessage â†’ AssistantMessage â†’ SystemMessage â†’ í´ë°±
- âœ… **usage ìš°ì„ **: í…ìŠ¤íŠ¸ë³´ë‹¤ usage ì •ë³´ë¥¼ ë¨¼ì € ì²˜ë¦¬
- âœ… **ìŠ¤íŠ¸ë¦¬ë°**: yieldë¡œ í…ìŠ¤íŠ¸ë¥¼ ì²­í¬ ë‹¨ìœ„ë¡œ ë°˜í™˜
- âœ… **SystemMessage ì§€ì›**: ì‹œìŠ¤í…œ ë©”íƒ€ë°ì´í„°ë¥¼ ì •ìƒì ìœ¼ë¡œ í‘œì‹œ

---

## ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: Manager Agent ì‘ë‹µ ì²˜ë¦¬

```python
# Manager Agent ì‹¤í–‰
async for response in manager_client.receive_response():
    # ManagerResponseHandlerê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬
    async for text in response_handler.process_response(response):
        print(text)  # "ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤..."

# usage ì •ë³´ëŠ” ì½œë°±ìœ¼ë¡œ ìë™ ìˆ˜ì§‘ë¨
# â†’ manager_client.total_input_tokens: 1500
# â†’ manager_client.total_output_tokens: 800
```

### ì˜ˆì‹œ 2: Worker Agent ì‘ë‹µ ì²˜ë¦¬

```python
# Worker Agent ì‹¤í–‰
async for response in query(prompt="ì½”ë“œ ì‘ì„±"):
    # WorkerResponseHandlerê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬
    async for text in response_handler.process_response(response):
        print(text)  # "```python\ndef hello():\n    print('Hello')\n```"

# usage ì •ë³´ëŠ” ì½œë°±ìœ¼ë¡œ ìë™ ìˆ˜ì§‘ë¨
# â†’ worker_agent.total_input_tokens: 500
# â†’ worker_agent.total_output_tokens: 200
```

---

## ğŸ› ë””ë²„ê¹… íŒ

### ë¡œê·¸ í™•ì¸

ë¡œê·¸ ë ˆë²¨ì„ DEBUGë¡œ ì„¤ì •í•˜ë©´ ìƒì„¸í•œ íŒŒì‹± ê³¼ì •ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
export LOG_LEVEL=DEBUG
python orchestrator.py "ì‘ì—… ì„¤ëª…"
```

**ì£¼ìš” ë¡œê·¸ ë©”ì‹œì§€**:
- `[Manager] Processing ResultMessage (usage info)` - ResultMessage ì²˜ë¦¬ ì‹œì‘
- `[Manager] Processing AssistantMessage` - AssistantMessage ì²˜ë¦¬ ì‹œì‘
- `[Manager] Token usage (ResultMessage): {...}` - usage ì •ë³´ ì¶”ì¶œ ì„±ê³µ
- `Extracted text from TextBlock #0` - í…ìŠ¤íŠ¸ ì¶”ì¶œ ì„±ê³µ
- `Unknown response type: XYZ` - ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì… ë°œê²¬ (í´ë°± ì²˜ë¦¬)

### ë¬¸ì œ í•´ê²°

#### 1. í…ìŠ¤íŠ¸ê°€ ì¶”ì¶œë˜ì§€ ì•ŠìŒ
- **ì¦ìƒ**: yieldëœ í…ìŠ¤íŠ¸ê°€ ì—†ìŒ
- **ì›ì¸**: content blocksì— TextBlockì´ ì—†ìŒ
- **í•´ê²°**: ë¡œê·¸ì—ì„œ content blocks êµ¬ì¡° í™•ì¸

#### 2. usage ì •ë³´ê°€ ëˆ„ë½ë¨
- **ì¦ìƒ**: í† í° ì‚¬ìš©ëŸ‰ì´ 0ìœ¼ë¡œ í‘œì‹œ
- **ì›ì¸**: usage ì½œë°±ì´ í˜¸ì¶œë˜ì§€ ì•ŠìŒ
- **í•´ê²°**: usage_callback ì„¤ì • í™•ì¸

#### 3. ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µ íƒ€ì…
- **ì¦ìƒ**: "Unknown response type" ê²½ê³ 
- **ì›ì¸**: SDK ë²„ì „ ë³€ê²½ ë˜ëŠ” ìƒˆë¡œìš´ ì‘ë‹µ íƒ€ì…
- **í•´ê²°**: í´ë°± ì²˜ë¦¬ë¡œ ìë™ ëŒ€ì‘ (ì •ìƒ ë™ì‘)

---

## ğŸ“š ì°¸ê³  ìë£Œ

- **Claude Agent SDK ê³µì‹ ë¬¸ì„œ**: https://docs.claude.com/en/api/agent-sdk/overview
- **ì½”ë“œ ìœ„ì¹˜**: `src/infrastructure/claude/sdk_executor.py`
- **ê´€ë ¨ ë¬¸ì„œ**: `claude-agent-sdk-features.md`
